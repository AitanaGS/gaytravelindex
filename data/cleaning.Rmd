---
title: "Untitled"
output: html_document
date: "2023-01-10"
---


```{r message=FALSE}
library(tidyverse)
library(janitor)
library(here)
library(readxl)
library(countrycode)
library(jsonlite)

here::i_am("analysis.Rmd")

```



### Read Data


```{r}
original_data <- read_xlsx(here("original","GTI_2012-2021.xlsx"))
```


```{r}
glimpse(original_data)
```



### Clean Data and Add Continents


```{r}
data <- original_data %>%
  clean_names(case = "lower_camel") %>%
  # mutate(across(c(where(is.numeric)),
  #              factor)) %>%
  mutate(country = case_when(
    country == "Central African Rep." ~ "Central African Republic",
    country == "China/Hong Kong" ~ "China incl. Hong Kong",
    country == "Dem.Rep. of Congo" ~ "Dem. Rep. of Congo",
    country == "Georgia (Europe)" ~ "Georgia",
    country == "Macedonia" ~ "North Macedonia",
    country == "USA*" ~ "USA",
    country == "Virgin Islands (USA)" ~ "Virgin Islands",
    country == "Rep. of the Congo" ~ "Republic of the Congo",
    country == "Saint Maarten" ~ "St. Maarten",
    country == "Bosnia-Hercegovina" ~ "Bosnia-Herzegovina",
    country == "Moldovia" ~ "Moldova",
    country == "Cape Verde" ~ "Cabo Verde",
    country == "Maledives" ~ "Maldives",
    TRUE ~ country
  )) %>%
  filter(country != "Bonaire" & country != "Saint Kitts & Nevis") %>%
  mutate(continent = countrycode(country, "country.name.en", "continent")) %>%
  mutate(continent = case_when(
    country == "Kosovo" ~ "Europe",
    country == "Virgin Islands" ~ "Americas",
    #country == "Virgin Islands (USA)" ~ "Americas",
    country == "Chechnya" ~ "Europe",
   # country == "Bonaire" ~ "Americas",
    country == "Maledives" ~ "Asia",
    TRUE ~ continent
  )) %>%
  relocate(continent, .after = country)
  
# Bonaire and Saint Kitts & Nevis in 2012, 2013, 2014 only
```


```{r}
countries2021 <- data %>%
  filter(year == 2021) %>%
  distinct(country) %>%
  pull()

countries2021
```



```{r}
data %>%
  filter(!country %in% countries2021) %>%
  distinct(country)

# data cleaning above
```





```{r}
summary(data)

```


### Save data


```{r}
write_csv(data, here("processed/GTI_2012-2021.csv"))
```




```{r}
dataJSON <- toJSON(data)
```



```{r}
write(dataJSON, here("processed/GTI_2012-2021.json"))
```

